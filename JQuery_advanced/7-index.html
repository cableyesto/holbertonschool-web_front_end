<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Task 7</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  </head>
  <body>
  </body>
  <script type="application/javascript">
    function addNewArticle(id, title, snippet) {
      let articleElement = $( "<li>" ).append(
        $( "<p>" ).append( 
          $( "<span>" ).text(`${id} - `),
          $( "<b>" ).text(title)
        ),
        $( "<p>" ).html(snippet).text() // strip html tags from API
      );

      $( "ul" ).append( articleElement );
    }

    function queryWikipedia(search) {
      let queryOptions = {
        url: `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${search}&format=json&origin=*`,
        type: "GET",
        dataType: "json"
      };
      $.ajax(queryOptions)
        .done(function(json) {
          let result = json.query.search;
          result.forEach((result) =>
            addNewArticle(result.pageid, result.title, result.snippet)
          );
        })
        .fail(function( xhr, status, errorThrown ) {
          console.log( "Error: " + errorThrown );
          console.log( "Status: " + status );
          console.dir( xhr );
      });
    }

    function createSearchForm() {
      $( "body" ).append(
        $( "<input>", { type: "text" } ),
        $( "<input>", { type: "submit", value: "Submit" } ).on( "click", function() {
          let inputValue = $( "input" ).first().val();
          if (inputValue !== "") {
            queryWikipedia(inputValue);
          }
        }),
        $( "<ul>" )
      );
    }

    $(document).ready(function() {
      if (typeof $.ajax === 'function') {
        createSearchForm();
      } else {
        return;
      }
    });
  </script>
</html>